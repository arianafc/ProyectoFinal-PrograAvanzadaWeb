@model List<SIGEP_ProyectoFinal.Models.EstudianteListItemModel>
@{
    Layout = "~/Views/Shared/_LayoutMain.cshtml";
    ViewBag.Title = "Listado de Estudiantes";
    var idRol = ViewBag.Rol ?? 0;
}

<h2 class="vacantes-titulo titulo-principal d-flex justify-content-center align-items-center">
    @(idRol == 2 ? "Estudiantes" : idRol == 3 ? "Mis Estudiantes" : "Estudiantes") @DateTime.Now.Year
</h2>

<div class="vacantes-titulo titulo-principal d-flex justify-content-between mb-0 align-items-center">
    <div class="dropdown">
        <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="filtroDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="fas fa-filter"></i> Filtros
        </button>
        <div class="dropdown-menu p-3" style="min-width: 300px;">
            <!-- Filtro de estado académico -->
            <div class="mb-3">
                <label for="filtroEstado" class="form-label">Estado académico</label>
                <select id="filtroEstado" class="form-control">
                    <option value="">Todos</option>
                    <option value="Aprobada">Aprobada</option>
                    <option value="Rezagado">Rezagado</option>
                </select>
            </div>

            <!-- Filtro de especialidad -->
            @if (ViewBag.Especialidades != null && (ViewBag.Especialidades as List<SIGEP_ProyectoFinal.Models.EspecialidadModel>).Count > 0)
            {
                <div class="mb-2">
                    <label for="filtroEspecialidad" class="form-label">Especialidad</label>
                    <select id="filtroEspecialidad" class="form-control">
                        <option value="">Todas</option>
                        @foreach (var esp in ViewBag.Especialidades as List<SIGEP_ProyectoFinal.Models.EspecialidadModel>)
                        {
                            <option value="@esp.IdEspecialidad">@esp.Nombre</option>
                        }
                    </select>
                </div>
            }
        </div>
    </div>
</div>

<div class="card rounded-5 p-3">
    <table id="tablaEstudiantes" class="display responsive nowrap w-100">
        <thead>
            <tr>
                <th>Cédula</th>
                <th>Nombre Completo</th>
                <th>Especialidad</th>
                <th>Teléfono</th>
                <th>Estado Académico</th>
                <th>Estado de Práctica</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<!-- MODAL PERFIL -->
<div class="modal fade" id="modalPerfil" tabindex="-1" aria-labelledby="modalPerfilLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content" style="border-radius: 12px; background-color: #F2F2F2; color: #2D594D;">
            <div class="modal-header" style="background-color: #2D594D; color: white;">
                <h5 class="modal-title" id="modalPerfilLabel">Perfil del Estudiante</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body px-4" id="perfilBody">
                <div class="text-center">
                    <span class="text-muted">Cargando datos...</span>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn CerrarModal" data-bs-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<!-- MODAL ACTUALIZAR ESTADO -->
<div class="modal fade" id="modalActualizarEstado" tabindex="-1" aria-labelledby="modalActualizarEstadoLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content" style="border-radius: 12px; background-color: #F2F2F2; color: #2D594D;">
            <div class="modal-header" style="background-color: #2D594D; color: white;">
                <h5 class="modal-title" id="modalActualizarEstadoLabel">Actualizar Estado Académico</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="formActualizarEstado" asp-action="ActualizarEstadoAcademico" asp-controller="Estudiante">
                <div class="modal-body px-4">
                    <input type="hidden" id="hdnIdUsuario" name="idUsuario" />
                    <div class="mb-3">
                        <label for="ddlNuevoEstado" class="form-label">Seleccione nuevo estado:</label>
                        <select id="ddlNuevoEstado" name="nuevoEstadoId" class="form-select w-100" style="font-size:14px">
                            <option value="1">Aprobada</option>
                            <option value="0">Rezagado</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer px-4">
                    <button type="button" class="btn CerrarModal" id="btnConfirmarActualizar">
                        <i class="fas fa-sync-alt"></i> Actualizar
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        window.EstuCfg = {
            rol: @idRol,
            urls: {
                get: '@Url.Action("GetEstudiantes", "Estudiante")',
                detalle: '@Url.Action("Detalle", "Estudiante")',
                actualizarEstado: '@Url.Action("ActualizarEstadoAcademico", "Estudiante")',
                eliminarDocumento: '@Url.Action("EliminarDocumento", "Estudiante")',
                desasignarPractica: '@Url.Action("DesasignarPractica", "Practicas")',
                login: '@Url.Action("IniciarSesion", "Home")'
            }
        };
    </script>

    <script src="~/js/Estudiante/ListarEstudiantes.js" asp-append-version="true"></script>
}