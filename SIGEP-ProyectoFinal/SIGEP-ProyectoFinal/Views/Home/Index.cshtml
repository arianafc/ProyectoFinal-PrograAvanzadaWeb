@model DashboardVM

@{
    Layout = "~/Views/Shared/_LayoutMain.cshtml";
    var rol = ViewBag.Rol;
    var nombre = ViewBag.Nombre as string;

    int totalEstudiantes = Model.EstudiantesConPractica + Model.EstudiantesSinPractica;

    int porcentajeAsignados = totalEstudiantes > 0
        ? (int)Math.Round((double)Model.EstudiantesConPractica * 100 / totalEstudiantes)
        : 0;
}

<input type="hidden" id="TempError" value="@TempData["SwalError"]" />
<input type="hidden" id="TempSuccess" value="@TempData["SwalSuccess"]" />

<main class="container py-4">

    @if (rol == 2)
    {
        @* ===================== ADMIN / COORDINADOR ===================== *@

        <h2 class="fw-bold mb-4">Dashboard - Prácticas Profesionales</h2>

        <!-- Cards resumen -->
        <div class="row g-4 mb-4">
            <div class="col-md-3">
                <div class="card shadow-sm border-0 text-white" style="background-color:#2D594D;">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="card-title">Estudiantes Activos</h6>
                                <h3 class="fw-bold">@Model.EstudiantesActivos</h3>
                            </div>
                            <i class="fas fa-user-graduate fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="card shadow-sm border-0 text-white" style="background-color: #768C46;">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="card-title">Prácticas Asignadas</h6>
                                <h3 class="fw-bold">@Model.PracticasAsignadas</h3>
                            </div>
                            <i class="fas fa-briefcase fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="card shadow-sm border-0 text-white" style="background-color: #2D594D;">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="card-title">Empresas Registradas</h6>
                                <h3 class="fw-bold">@Model.EmpresasRegistradas</h3>
                            </div>
                            <i class="fas fa-building fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="card shadow-sm border-0 text-white" style="background-color: #768C46;">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="card-title">Prácticas Finalizadas</h6>
                                <h3 class="fw-bold">@Model.PracticasFinalizadas</h3>
                            </div>
                            <i class="fas fa-check-circle fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sección de progreso + accesos rápidos -->
        <div class="row g-4 mb-4">
            <div class="col-md-6">
                <div class="card shadow-sm h-100">
                    <div class="card-body">
                        <h5 class="card-title fw-bold">Progreso General de Estudiantes</h5>

                        <p class="mb-1">
                            Estudiantes con práctica asignada
                            <strong>
                                (@Model.EstudiantesConPractica de @totalEstudiantes)
                            </strong>
                        </p>

                        <div class="progress mb-2" style="height: 25px;">
                            <div class="progress-bar fw-bold"
                                 role="progressbar"
                                 style="width: @porcentajeAsignados%; background-color:#8CA653;"
                                 aria-valuenow="@porcentajeAsignados"
                                 aria-valuemin="0"
                                 aria-valuemax="100">
                                @porcentajeAsignados%
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <div class="col-md-6">
                <div class="card shadow-sm h-100">
                    <div class="card-body">
                        <h5 class="card-title fw-bold">Accesos Rápidos</h5>
                        <div class="d-grid gap-2">
                            <a asp-action="ListarEstudiante" asp-controller="Estudiante" class="btn" style="background-color:#2D594D; color:white;">
                                <i class="fas fa-user-plus me-2"></i>Ver Estudiantes
                            </a>
                            <a asp-action="ListarEmpresas" asp-controller="Empresa" class="btn" style="background-color:#8CA653; color:white;">
                                <i class="fas fa-building me-2"></i>Agregar empresa
                            </a>
                            <a asp-action="VacantesEstudiantes" asp-controller="Practicas" class="btn" style="background-color:#768C46; color:white;">
                                <i class="fas fa-briefcase me-2"></i>Asignar práctica
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabla resumen -->
        <div class="card shadow-sm">
            <div class="card-body">
                <h5 class="fw-bold mb-3">Últimas Prácticas Asignadas</h5>

                <div class="table-responsive">
                    <table class="table align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>Estudiante</th>
                                <th>Especialidad</th>
                                <th>Empresa</th>
                                <th>Fecha de inicio</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var p in Model.UltimasPracticasAsignadas)
                            {
                                <tr>
                                    <td>@p.Estudiante</td>
                                    <td>@p.Especialidad</td>
                                    <td>@p.NombreEmpresa</td>
                                    <td>@p.FechaAplicacion</td>
                                    <td>
                                      
                                    @p.Estado
                              
                            </td>
                        </tr>
                                                }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    }

    @if (rol == 1)
    {
        @* ===================== ESTUDIANTE ===================== *@

        <section class="mb-5 text-center" style="background-color:#EAF2D8; padding: 3rem; border-radius: 1rem;">
            <h2 class="fw-bold mb-3" style="color:#2D594D;">¡Bienvenido a SIGEP!</h2>
            <p style="font-size:1.2rem; max-width:600px; margin:auto;">
                Aquí podrás gestionar todo lo relacionado con tu práctica profesional de forma sencilla y organizada.
            </p>
            <a href="@Url.Action("PostulacionesEstudiantes", "Practicas")" class="btn btn-lg mt-3" style="background-color:#2D594D; color:white;">Mis Postulaciones</a>
        </section>

        <section class="row g-4 text-center">
            <div class="col-md-4">
                <div class="card shadow-sm h-100" style="border:none;">
                    <div class="card-body">
                        <i class="fas fa-briefcase fa-3x mb-3" style="color:#8CA653;"></i>
                        <h5 class="fw-bold">Mis Postulaciones</h5>
                        <p>Explora oportunidades disponibles y gestiona tu postulación fácilmente.</p>
                        <a href="@Url.Action("PostulacionesEstudiantes", "Practicas")" class="btn btn-sm" style="background-color:#8CA653; color:white;">Ver Postulaciones</a>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card shadow-sm h-100" style="border:none;">
                    <div class="card-body">
                        <i class="fas fa-tasks fa-3x mb-3" style="color:#768C46;"></i>
                        <h5 class="fw-bold">Mi Práctica</h5>
                        <p>Consulta el estado y detalles de tu práctica profesional actual.</p>
                        <a asp-action="VisualizacionPractica" asp-controller="Practicas" class="btn btn-sm" style="background-color:#768C46; color:white;">Ver Mi Práctica</a>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card shadow-sm h-100" style="border:none;">
                    <div class="card-body">
                        <i class="fas fa-bullhorn fa-3x mb-3" style="color:#2D594D;"></i>
                        <h5 class="fw-bold">Comunicados</h5>
                        <p>Mantente informado con anuncios y noticias relevantes de coordinación.</p>
                        <a asp-action="Comunicados" asp-controller="Comunicados" class="btn btn-sm" style="background-color:#2D594D; color:white;">Ver Comunicados</a>
                    </div>
                </div>
            </div>
        </section>

        <section class="text-center mt-5">
            <p class="text-muted">Mantén tu perfil siempre actualizado para aprovechar al máximo tus oportunidades.</p>
            <a asp-action="Perfil" asp-controller="Perfil"
               class="btn btn-lg"
               style="background-color: #2D594D; color: #fff; border-radius: 50px; padding: 0.75rem 2rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;">
                <i class="fas fa-user-circle me-2"></i>Ir a Mi Perfil
            </a>
        </section>

        <section class="text-center mt-5">
            <p class="text-muted">Tu futuro comienza hoy. Aprovecha cada oportunidad.</p>
        </section>
    }

</main>

@section scripts {
    <script src="~/js/alertasmostrar.js"></script>
}
